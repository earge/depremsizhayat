<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
    body{
      margin: 0px;
      padding: 0px;
      font-family: Arial, Helvetica, sans-serif;
    }

    .bubble-menu{
      height: 50px;
      width: 100%;
      box-sizing: border-box;
      position: relative;
      -webkit-touch-callout: none; /* iOS Safari */
      -webkit-user-select: none; /* Safari */
      -khtml-user-select: none; /* Konqueror HTML */
        -moz-user-select: none; /* Old versions of Firefox */
          -ms-user-select: none; /* Internet Explorer/Edge */
              user-select: none; /* Non-prefixed version, currently
                                    supported by Chrome, Edge, Opera and Firefox */
    }


    .bubble-menu.stage-0 .sub-1{margin-top: 0px;}
    .bubble-menu.stage-0 .sub-2{margin-top: 0px;}
    .bubble-menu.stage-0 .sub-3{margin-top: 0px;}

    .bubble-menu.stage-1 .sub-1{margin-top: 50px;}
    .bubble-menu.stage-1 .sub-2{margin-top: 50px;}
    .bubble-menu.stage-1 .sub-3{margin-top: 50px;}

    .bubble-menu.stage-2 .sub-1{margin-top: 50px;}
    .bubble-menu.stage-2 .sub-2{margin-top: 100px;}
    .bubble-menu.stage-2 .sub-3{margin-top: 100px;}

    .bubble-menu.stage-3 .sub-1{margin-top: 50px;}
    .bubble-menu.stage-3 .sub-2{margin-top: 100px;}
    .bubble-menu.stage-3 .sub-3{margin-top: 150px;}

    .bubble-menu .bubble{
      height: 100%;
      width: 100%;
      position: absolute;
      background-color: white;
      box-sizing: border-box;
      display: flex;
      padding:10px;
      overflow: hidden;
    }

    .bubble-menu .bubble.main{z-index: 4;}
    .bubble-menu .bubble.sub-1{z-index: 3;}
    .bubble-menu .bubble.sub-2{z-index: 2;}
    .bubble-menu .bubble.sub-3{z-index: 1;}

    .bubble-menu .sub{
      transition: margin-top .2s ease-in-out;
      border-top:2px solid rgb(245,245,245);
    }

    /* BUBBLES */
    .bubble-menu .bubble div{
      height: 100%;
      border-radius: 30px;
      line-height: 28px;
      padding: 0px 10px;
      white-space: nowrap;
      font-size: 14px;
      color:white;
      opacity: 0;
      position: relative;
      transition: transform .1s linear;
      animation-name: fadeIn;
      animation-duration: .2s;
      animation-timing-function: linear;
      animation-iteration-count: 1;
      animation-direction: alternate;
      animation-fill-mode: forwards;
    }
    .bubble-menu .bubble div.deactive{
      transform: scale(0.95);
      background-color: rgb(200,200,200) !important;
    }
    .bubble-menu .bubble div.active{
      box-shadow: 0px 0px 0px 2px rgb(235, 137, 0),
                  inset 0px 0px 0px 1px white;
    }


    .bubble-menu .bubble div:last-child::after{
      content: "";
      background-color: transparent;
      position: absolute;
      height: 100%;
      width: 10px;
      right: -10px;
    }


    .bubble-menu .bubble div{
      margin-right: 10px;
    }

    .bubble-menu .bubble div:hover{
      transform: scale(1.04);
    }

    .bubble-menu .bubble.main > div{
      background-color: rgb(255,149,0);
    }
    .bubble-menu .bubble.sub-1 > div{
      background-color: rgb(255, 157, 20)
    }
    .bubble-menu .bubble.sub-2 > div{
      background-color: rgb(255, 166, 41)
    }
    .bubble-menu .bubble.sub-3 > div{
      background-color: rgb(255, 174, 61)
    }

    @@keyframes fadeIn{
      100%{opacity: 1;}
    }


    /* LOADING */

    .loading{
      padding: 10px;
      height: 50px;
      width: 100%;
      display: flex;
      justify-content: stretch;
      box-sizing: border-box;
    }

    .loading > div{
      background-color: rgb(230,230,230);
      width: 100%;
      border-radius: 30px;
      position: relative;
      overflow: hidden;
    }
    .loading > div::after{
      content: "";
      display: block;
      position: absolute;
      top: 0;
      width: 100%;
      height: 100%;
      transform: translateX(-100px);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
      animation: loading 0.8s infinite;
    }
    .loading > div:not(:last-child){
      margin-right: 10px;
    }
    @@keyframes loading {
      100% {
          transform: translateX(100%);
      }
    }


    </style>
</head>
<body>
    <div class="bubble-menu"></div>
    <script>
        let menu = {
            "Elektronik": {
                "Bilgisayar & Tablet": {
                    "Dizüstü Blgisayar": [
                        "Notebook",
                        "Oyun Bilgisayarı",
                        "İkisi Bir Arada"
                    ],
                    "Tablet": [
                        "Apple",
                        "Samsung",
                        "Diğer"
                    ],
                    "Masaüstü Bigisayar": [
                        "All-in-one",
                        "Masaüstü",
                        "Mini Masaüstü"
                    ],
                    "Oyuncu Özel": [
                        "Oyun Bilgisayarı",
                        "Oyun Donanımları",
                        "Klavye",
                        "Mouse",
                        "Kulaklık",
                        "Monitör"
                    ],
                    "Veri Depolama": [
                        "Usb Bellek",
                        "Taşınabilir Disk",
                        "SSD",
                        "Hafıza Kartı"
                    ],
                    "Bilgisayar Bileşenleri": [
                        "Anakart",
                        "Ekran Kartları",
                        "Bellek (RAM)",
                        "İşlemciler",
                        "Disk",
                        "Kasa"
                    ],
                    "Ağ - Modem - Akıllı Ev": [
                        "Access Point",
                        "Router",
                        "Modemler"
                    ],
                    "Çevre Birimleri": [
                        "Mouse",
                        "Klavye & Mouse Set",
                        "Klavye",
                        "Monitör",
                        "Yazıcı"
                    ],
                    "Yazılım Ürünleri": [
                        "Antivirüs ve Güvenlik",
                        "Office Yazılımları"
                    ],
                    "Aksesuarlar": [
                        "Notebook Çantaları",
                        "Tablet ve iPad Aksesuarları",
                        "Kablolar/Switch ve Çoklayıcılar"
                    ],
                    "Kulaklık": null
                },
                "Yazıcılar & Projeksiyon": {
                    "Yazıcılar": [
                        "Lazer Yazıcı",
                        "Tanklı Yazıcı",
                        "Mürekkep Püskürtmeli Yazıcı",
                        "Nokta Vuruşlu Yazıcı",
                        "Fotoğraf Yazıcısı",
                        "3D Yazıcı",
                        "Barkod Yazıcı",
                        "Tarayıcı"
                    ]
                }
            },
            "Teknoloji": null
        }

        // let colors =[ 
        //               "#9AC8EB","#5784BA","#CCD4BF","#E7CBA9","#EEBAB2","#F5BFD2","#A1CDCE","#E5DB9C","#BEB4C5","#E6A57E",
        //               "#218B82","#EB96AA","#9AD9DB","#98D4BB","#C6C9D0","#C54B6C","#E5B3BB","#C47484","#D5E4C3","#F9968B",
        //               "#F27348","#26474E","#76CDCD","#2CCED2","#B8E0F6","#A4CCE3","#37667E","#DEC4D6","#7B92AA","#84A6D6",
        //               "#4382BB","#E4CEE0","#A15D98","#DC828F","#F7CE76","#E8D6CF","#8C7386","#9C9359","#F9CAD7","#A57283",
        //               "#8DA47E"
        //             ]

        window.movement = true
        //bubbleMenuLoading()
        createBubbleMenu(menu)

        function createBubbleMenu(menu) {

            /* DIV IN HTML */
            let bubbleMenuDiv = document.querySelector(".bubble-menu")

            /* DIV */
            let mainCategoryDiv = document.createElement("div")
            let subCategoryDiv_1 = document.createElement("div")
            let subCategoryDiv_2 = document.createElement("div")
            let subCategoryDiv_3 = document.createElement("div")

            /* CLASS */
            mainCategoryDiv.classList.add("bubble", "main")
            subCategoryDiv_1.classList.add("bubble", "sub", "sub-1")
            subCategoryDiv_2.classList.add("bubble", "sub", "sub-2")
            subCategoryDiv_3.classList.add("bubble", "sub", "sub-3")

            /* APPEND */
            bubbleMenuDiv.appendChild(mainCategoryDiv)
            bubbleMenuDiv.appendChild(subCategoryDiv_1)
            bubbleMenuDiv.appendChild(subCategoryDiv_2)
            bubbleMenuDiv.appendChild(subCategoryDiv_3)

            /* SET STAGE FOR POSITION */
            bubbleMenuDiv.classList.add("stage-0")

            /* FILL THE MAIN CATEGORIES */
            Object.keys(menu).forEach((mainCategory, index) => {
                let bubble = document.createElement("div")
                bubble.addEventListener("mouseup", function (event) {
                    if (movement) {
                        fillSubCategory_1(mainCategory)
                        deactivate(mainCategoryDiv, event.target)
                        selectedBubble(mainCategory)
                    }
                })
                bubble.style.animationDelay = `${0.1 * index}s`
                bubble.innerHTML = mainCategory
                mainCategoryDiv.appendChild(bubble)
            })

            /* FILL SUB CATEGORY_1 */
            function fillSubCategory_1(mainCategory) {
                if (menu[mainCategory] != null) {
                    resetSubCategory(subCategoryDiv_1)
                    resetStage()
                    bubbleMenuDiv.classList.add("stage-1")
                    Object.keys(menu[mainCategory]).forEach((subCategory_1, index) => {
                        let bubble = document.createElement("div")
                        bubble.addEventListener("mouseup", function (event) {
                            if (movement) {
                                fillSubCategory_2(mainCategory, subCategory_1)
                                deactivate(subCategoryDiv_1, event.target)
                                selectedBubble(mainCategory, subCategory_1)
                            }
                        })
                        bubble.innerHTML = subCategory_1
                        bubble.style.animationDelay = `${0.1 * index}s`
                        subCategoryDiv_1.appendChild(bubble)
                    })
                } else {
                    resetStage()
                    bubbleMenuDiv.classList.add("stage-0")
                }
            }

            /* FILL SUB CATEGORY_2 */
            function fillSubCategory_2(mainCategory, subCategory_1) {
                if (menu[mainCategory][subCategory_1] != null) {
                    resetSubCategory(subCategoryDiv_2)
                    resetStage()
                    bubbleMenuDiv.classList.add("stage-2")
                    Object.keys(menu[mainCategory][subCategory_1]).forEach((subCategory_2, index) => {
                        let bubble = document.createElement("div")
                        bubble.addEventListener("mouseup", function (event) {
                            if (movement) {
                                fillSubCategory_3(mainCategory, subCategory_1, subCategory_2)
                                deactivate(subCategoryDiv_2, event.target)
                                selectedBubble(mainCategory, subCategory_1, subCategory_2)
                            }
                        })
                        bubble.style.animationDelay = `${0.1 * index}s`
                        bubble.innerHTML = subCategory_2
                        subCategoryDiv_2.appendChild(bubble)
                    })
                } else {
                    resetStage()
                    bubbleMenuDiv.classList.add("stage-1")
                }
            }

            /* FILL SUB CATEGORY_3 */
            function fillSubCategory_3(mainCategory, subCategory_1, subCategory_2) {
                if (menu[mainCategory][subCategory_1][subCategory_2] != null) {
                    resetSubCategory(subCategoryDiv_3)
                    resetStage()
                    bubbleMenuDiv.classList.add("stage-3")
                    Array.from(menu[mainCategory][subCategory_1][subCategory_2]).forEach((subCategory_3, index) => {
                        let bubble = document.createElement("div")
                        bubble.style.animationDelay = `${0.1 * index}s`
                        bubble.addEventListener("mouseup", function (event) {
                            if (movement) {
                                deactivate(subCategoryDiv_3, event.target)
                                selectedBubble(mainCategory, subCategory_1, subCategory_2, subCategory_3)
                            }
                        })
                        bubble.innerHTML = subCategory_3
                        subCategoryDiv_3.appendChild(bubble)
                    })
                } else {
                    resetStage()
                    bubbleMenuDiv.classList.add("stage-2")
                }
            }

            /* RESET SUB CATEGORY */
            function resetSubCategory(subCategoryDiv) {
                Array.from(subCategoryDiv.children).forEach(child => child.remove())
            }

            /* RESET STAGE */
            function resetStage() {
                bubbleMenuDiv.classList.remove("stage-0", "stage-1", "stage-2", "stage-3")
            }

            /* SCROLL EVENTS DEFINE */
            addScroll(document.querySelector(".main"))
            addMobileScroll(document.querySelector(".main"))
            longPress(document.querySelector(".main"))
            addScroll(document.querySelector(".sub-1"))
            addMobileScroll(document.querySelector(".sub-1"))
            longPress(document.querySelector(".sub-1"))
            addScroll(document.querySelector(".sub-2"))
            addMobileScroll(document.querySelector(".sub-2"))
            longPress(document.querySelector(".sub-2"))
            addScroll(document.querySelector(".sub-3"))
            addMobileScroll(document.querySelector(".sub-3"))
            longPress(document.querySelector(".sub-3"))

            function deactivate(subCategory, element) {
                element.classList.remove("deactive")
                element.classList.add("active")
                Array.from(subCategory.children).filter(item => item != element).forEach(item => item.classList.add("deactive"))
                Array.from(subCategory.children).filter(item => item != element).forEach(item => item.classList.remove("active"))
            }

        }

        function bubbleMenuLoading() {

            /* DIV IN HTML */
            let bubbleMenuDiv = document.querySelector(".bubble-menu")

            /* LOADING CONTAINER */
            let bubbleLoadingDiv = document.createElement("div")
            bubbleLoadingDiv.classList.add("loading")

            /* SHADOW DIVS */
            for (i = 0; i < 10; i++) { bubbleLoadingDiv.appendChild(document.createElement("div")) }

            /* APPEND */
            bubbleMenuDiv.appendChild(bubbleLoadingDiv)

        }


        /* SCROLL EVENT FOR DESKTOP */
        function addScroll(element) {
            element.style.cursor = "default"
            let pos = { top: 0, left: 0, x: 0, y: 0 };

            const mouseDownHandler = function (e) {

                element.style.userSelect = 'none';
                pos = {
                    left: element.scrollLeft,
                    x: e.clientX,
                };
                document.addEventListener('mousemove', mouseMoveHandler);
                document.addEventListener('mouseup', mouseUpHandler);
            };

            const mouseMoveHandler = function (e) {
                const dx = e.clientX - pos.x;
                element.scrollLeft = pos.left - dx;
            };

            const mouseUpHandler = function () {
                element.style.removeProperty('user-select');

                document.removeEventListener('mousemove', mouseMoveHandler);
                document.removeEventListener('mouseup', mouseUpHandler);
            };
            element.addEventListener('mousedown', mouseDownHandler);
        }

        /* SCROLL EVENT FOR MOBILE */
        function addMobileScroll(element) {
            let pos = { top: 0, left: 0, x: 0, y: 0 };

            const touchDownHandler = function (e) {

                element.style.userSelect = 'none';
                pos = {
                    left: element.scrollLeft,
                    x: e.changedTouches[0].clientX,
                };
                document.addEventListener('touchmove', touchMoveHandler);
                document.addEventListener('touchend', touchUpHandler);
            };

            const touchMoveHandler = function (e) {
                const dx = e.changedTouches[0].clientX - pos.x;
                element.scrollLeft = pos.left - dx;
            };

            const touchUpHandler = function () {

                element.style.removeProperty('user-select');

                document.removeEventListener('touchmove', touchMoveHandler);
                document.removeEventListener('touchend', touchUpHandler);
            };
            element.addEventListener('touchstart', touchDownHandler);
        }

        /* DETECT CLICK OR SCROLL */
        function longPress(element) {
            element.addEventListener("mouseup", function () {
                clearTimeout(pressTimer)
                movement = true
                element.style.cursor = "default"
            })
            element.addEventListener("mousedown", function () {
                pressTimer = window.setTimeout(function () {
                    movement = false
                    element.style.cursor = "grabbing"
                }, 250);
            })
        }

        var defaultPrevent = function (e) { e.preventDefault(); }
        document.querySelector(".bubble-menu").addEventListener("touchmove", defaultPrevent);

        function selectedBubble(main, sub_1, sub_2, sub_3) {
            var model = {
                "main": main ? main : null,
                "sub_1": sub_1 ? sub_1 : null,
                "sub_2": sub_2 ? sub_2 : null,
                "sub_3": sub_3 ? sub_3 : null,
            }
            console.log(model)
        }
    </script>
</body>
</html>

